# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this workspace.

## Repository Overview

This repository contains the **RacePrep** mobile application - a triathlon tracking and planning app built with React Native and Expo.

**This Repository**: `https://github.com/tigerswim/raceprep.git`
- Branch: `main`
- Platform: React Native with Expo (iOS, Android, Web)

**Related Repositories** (separate projects):
- **marketing-site** - `https://github.com/tigerswim/kineticbrandpartners.git`
- **job-tracker** - `https://github.com/tigerswim/job-tracker.git`
- **sagenet-website** - `https://github.com/tigerswim/sagenet-website.git`

## Project Description

**"The only triathlon app that understands your race as a complete event, not three separate sports."**

RacePrep is a comprehensive triathlon tracking application with:
- Race result analytics and transition timing
- Strava training integration
- Race planning and nutrition tools
- Performance dashboard with multiple widgets
- User-created race management

## Working with This Project

### Before Starting Work
1. **Verify current directory** - Use `pwd` to confirm you're in `/Users/danhoeller/Website Development/kineticbrandpartners/RacePrep`
2. **Check git remote** - Run `git remote -v` to confirm correct repository (should show `https://github.com/tigerswim/raceprep.git`)
3. **Read project documentation** - Key files: README.md, QUICKSTART.md, CONTEXT.md, DEVELOPMENT_PLAN.md

### Project Commands

```bash
# Development
npm start              # Start Expo dev server (port 8081)
npm run web            # Start web development server
npm run ios            # Start iOS simulator (macOS only)
npm run android        # Start Android emulator

# Building
npm run build:web      # Build for web (exports to dist/)
npm run preview:web    # Preview web build locally

# Testing
npm test               # Run Jest tests
npm run test:watch     # Run tests in watch mode
npm run test:coverage  # Generate coverage report
npm run lint           # Run ESLint

# Project Management
npm run reset-project  # Reset project to clean state
```

## Important Paths

### Source Code
- **Main source**: `src/`
- **Components**: `src/components/` (UI components, modals, dashboard widgets)
- **Screens**: `src/screens/` (Auth, Dashboard, Races, Courses, Planning, Profile)
- **Services**: `src/services/` (API integrations, enhanced backend)
- **App routing**: `src/app/` (Expo Router file-based routing)
- **Store**: `src/store/` (Redux Toolkit slices and middleware)
- **Utils**: `src/utils/` (calculations, formatting, validation, logger)
- **Tests**: `src/__tests__/` and `src/components/__tests__/`

### Configuration
- **Root**: `package.json`, `app.json`, `tsconfig.json`, `tailwind.config.js`
- **Environment**: `.env.local` (NEVER commit to git!)
- **Babel**: `babel.config.js`
- **Metro**: `metro.config.js`
- **Jest**: `jest.config.js`, `jest.setup.js`
- **ESLint**: `eslint.config.js`

### Backend
- **API Server**: `server/` (Node.js/Express on port 3001)
- **Supabase**: SQL migrations in root and `supabase/`
- **Database**: PostgreSQL via Supabase

### Build & Deploy
- **Web output**: `dist/` (generated by `npm run build:web`)
- **Netlify**: `netlify.toml`, `netlify/functions/`
- **Public assets**: `public/`

## Repository Structure

```
RacePrep/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/              # Expo Router file-based routing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (tabs)/       # Tab navigation screens
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ _layout.tsx   # Root layout
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.tsx     # Entry point
‚îÇ   ‚îú‚îÄ‚îÄ components/       # UI components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/    # Dashboard widgets
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ training/     # Training-related components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/           # Reusable UI elements
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __tests__/    # Component tests
‚îÇ   ‚îú‚îÄ‚îÄ screens/          # Screen components
‚îÇ   ‚îú‚îÄ‚îÄ services/         # API & backend services
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/          # External APIs (Strava, RunSignup)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ enhanced/     # Enhanced backend services
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ shared/       # Shared utilities
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __tests__/    # Service tests
‚îÇ   ‚îú‚îÄ‚îÄ store/            # Redux store
‚îÇ   ‚îú‚îÄ‚îÄ utils/            # Utilities
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calculations/ # Math & algorithms
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ formatting/   # Data formatting
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validation/   # Input validation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logger.ts     # Logging utility
‚îÇ   ‚îú‚îÄ‚îÄ hooks/            # Custom React hooks
‚îÇ   ‚îú‚îÄ‚îÄ contexts/         # React contexts
‚îÇ   ‚îú‚îÄ‚îÄ constants/        # App constants
‚îÇ   ‚îú‚îÄ‚îÄ types/            # TypeScript types
‚îÇ   ‚îî‚îÄ‚îÄ data/             # Static/mock data
‚îú‚îÄ‚îÄ server/               # Node.js/Express API server
‚îú‚îÄ‚îÄ assets/               # Images, fonts, icons
‚îú‚îÄ‚îÄ public/               # Web public assets
‚îú‚îÄ‚îÄ supabase/             # Supabase migrations
‚îú‚îÄ‚îÄ tests/                # E2E tests
‚îú‚îÄ‚îÄ cypress/              # Cypress tests
‚îú‚îÄ‚îÄ prd-documents/        # Product requirements
‚îî‚îÄ‚îÄ dist/                 # Web build output (generated)
```

## Technology Stack

### Frontend
- **Framework**: React Native 0.79.5 with Expo SDK 53
- **Language**: TypeScript 5.8.3
- **UI**: NativeWind (Tailwind CSS for React Native)
- **Navigation**: Expo Router 5.1.6 (file-based routing)
- **State**: Redux Toolkit 2.9.0 with React Redux 9.2.0
- **Forms**: React Hook Form 7.62.0 with Yup 1.7.0 validation
- **Icons**: Lucide React Native, React Icons (Tabler)
- **Charts**: SVG-based custom charts

### Backend
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth
- **API Server**: Node.js/Express (port 3001)
- **APIs**: Strava, RunSignup, OpenWeatherMap, Google Maps

### Testing
- **Framework**: Jest 30.1.3
- **React Testing**: React Native Testing Library 13.3.3
- **E2E**: Cypress, Playwright
- **Coverage**: Jest coverage reporting

### Build & Deploy
- **Web Bundler**: Metro
- **Deployment**: Netlify (Functions + Static Hosting)
- **Environment**: Node.js 18+ (LTS recommended)

## Environment Variables

RacePrep uses `.env.local` at the project root:

```env
# Supabase
EXPO_PUBLIC_SUPABASE_URL=your_supabase_url
EXPO_PUBLIC_SUPABASE_ANON_KEY=your_anon_key

# Strava
EXPO_PUBLIC_STRAVA_CLIENT_ID=your_client_id
EXPO_PUBLIC_STRAVA_CLIENT_SECRET=your_client_secret

# RunSignup
EXPO_PUBLIC_RUNSIGNUP_API_KEY=your_api_key
EXPO_PUBLIC_RUNSIGNUP_SECRET=your_secret

# OpenWeatherMap
EXPO_PUBLIC_OPENWEATHERMAP_API_KEY=your_api_key

# Google Maps
EXPO_PUBLIC_GOOGLE_MAPS_API_KEY=your_api_key
```

**CRITICAL: NEVER commit `.env.local` to git!** It's already in `.gitignore`.

**Verification**: Run `node test-env-connections.js` to verify all API connections.

## Git Workflow

### Standard Workflow
```bash
# Check status
git status

# Stage changes
git add .

# Commit with descriptive message
git commit -m "feat: description of changes

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"

# Push to remote
git push origin main
```

### Branch Strategy
- **Main branch**: `main`
- **Feature branches**: Create from `main` for new features
- **Always verify remote**: Run `git remote -v` before pushing

### Commit Message Guidelines
- Use conventional commit format: `feat:`, `fix:`, `chore:`, `docs:`, `refactor:`, `test:`
- Include Claude Code attribution (see example above)
- Be descriptive but concise

## Development Workflow

### Starting Development

1. **Terminal 1**: Start API server
   ```bash
   cd server
   node server.js
   ```
   Server runs on http://localhost:3001

2. **Terminal 2**: Start Expo dev server
   ```bash
   npm start
   ```
   Web app runs on http://localhost:8081

3. **Access the app**:
   - Web: http://localhost:8081
   - iOS: Press `i` in terminal (macOS only)
   - Android: Press `a` in terminal
   - Mobile device: Scan QR code with Expo Go app

### Development Best Practices

1. **Always use the logger utility** (`src/utils/logger.ts`)
   - Replace `console.log` with `logger.debug`, `logger.info`, `logger.warn`, `logger.error`
   - Logs only appear in development, silent in production

2. **Use TypeScript strictly**
   - Run `npx tsc --noEmit` to check for type errors
   - Fix type errors before committing

3. **Write tests for new features**
   - Component tests in `src/components/__tests__/`
   - Service tests in `src/services/__tests__/`
   - Run `npm test` before committing

4. **Follow existing code patterns**
   - Use NativeWind/Tailwind for styling
   - Use Redux Toolkit for state management
   - Use React Hook Form for forms
   - Use Lucide/Tabler icons consistently

5. **Security best practices**
   - Validate all user inputs
   - Sanitize database queries (prevent SQL injection)
   - Use Supabase RLS policies
   - Never expose API keys in client code

6. **Performance considerations**
   - Use React.memo for expensive components
   - Implement virtualization for long lists
   - Optimize images and assets
   - Monitor bundle size

## Common Tasks

### Adding a new npm package
```bash
npm install <package-name>
# or
npm install --save-dev <package-name>  # for dev dependencies
```

### Creating a new screen
1. Add file to `src/app/(tabs)/` for tab screens
2. Use TypeScript and export default component
3. Follow existing screen patterns
4. Update navigation types if needed

### Creating a new component
1. Add file to appropriate `src/components/` subdirectory
2. Use TypeScript interfaces for props
3. Use NativeWind for styling
4. Write tests in `src/components/__tests__/`

### Adding a new API endpoint
1. Create/update file in `server/`
2. Implement validation and error handling
3. Test with `node server.js` and API client
4. Update Netlify functions if needed

### Database changes
1. Create SQL migration file in `supabase/migrations/`
2. Test migration locally
3. Apply via Supabase dashboard or CLI
4. Update TypeScript types if needed

### Running tests
```bash
npm test                 # Run all tests
npm run test:watch       # Watch mode
npm run test:coverage    # With coverage report
npm run lint             # Lint code
```

### Building for production
```bash
# Web build
npm run build:web
npm run preview:web      # Preview locally

# Mobile builds (requires EAS)
npx eas build --platform ios
npx eas build --platform android
```

## Deployment

### Web Deployment (Netlify)
- **Platform**: Netlify
- **Base Directory**: Root (`/`)
- **Build Command**: `npm run build:web`
- **Publish Directory**: `dist/`
- **Functions**: `netlify/functions/`
- **Config**: `netlify.toml`
- **Trigger**: Push to `main` branch
- **URL**: https://raceprep.netlify.app (or custom domain)

### Environment Variables in Netlify
- Add all `EXPO_PUBLIC_*` variables to Netlify dashboard
- Never commit secrets to repository

### Mobile Deployment
- **iOS**: App Store via EAS Build
- **Android**: Google Play via EAS Build
- Future: Configure at `raceprep.kineticbrandpartners.com`

## Key Documentation Files

### Getting Started
- **README.md** - Project overview, features, setup instructions
- **QUICKSTART.md** - Fast setup guide for Claude Code in Zed
- **CONTEXT.md** - Complete project context for AI assistants
- **START_HERE.md** - New developer onboarding

### Development
- **DEVELOPMENT_PLAN.md** - Detailed roadmap and priorities
- **FEATURES.md** - Feature list and specifications
- **TRAINING_PLAN_ENGINE.md** - Training plan system documentation
- **TESTING_GUIDE.md** - Testing strategies and guidelines

### Setup & Configuration
- **SUPABASE_SETUP.md** - Database setup guide
- **API_SETUP.md** - API integration setup
- **DEPLOYMENT_GUIDE.md** - Deployment instructions
- **DEPLOYMENT_TROUBLESHOOTING.md** - Common deployment issues

### Project Status
- **PHASE_2_COMPLETION_SUMMARY.md** - Recent accomplishments
- **PRODUCTION_READY_SUMMARY.md** - Production readiness status
- **CHANGELOG.md** - User-facing changelog
- **CHANGELOG_TECHNICAL.md** - Technical changelog

### Reference
- **DOCUMENTATION_INDEX.md** - Complete documentation catalog
- **AGENT_SETUP_GUIDE.md** - Multi-agent development system
- **AGENT_TEMPLATES.md** - Agent description templates

## File Organization Rules

### ‚úÖ Correct Structure
- All React Native code in `src/`
- App routing in `src/app/`
- API server in `server/`
- Tests colocated with source
- Documentation at root level

### ‚ùå Avoid
- Placing source files at root
- Mixing test files with source (use `__tests__/` subdirectories)
- Creating duplicate directories
- Committing build artifacts (`dist/`, `node_modules/`)
- Committing `.env.local` or other secrets

## Testing

### Test Structure
- **Unit tests**: Component and utility tests
- **Integration tests**: Service and API tests
- **E2E tests**: Cypress and Playwright

### Current Test Status (as of January 2025)
- ‚úÖ Service tests: 7/7 passing
- ‚ö†Ô∏è Component tests: Setup complete, some need refinement
- ‚úÖ Linting: 0 errors, 30 warnings

### Running Tests
```bash
npm test                 # All tests
npm run test:watch       # Watch mode
npm run test:coverage    # With coverage
```

## Important Notes

### Logging Policy
- **NEVER use `console.log` directly**
- Use `logger.debug()`, `logger.info()`, `logger.warn()`, `logger.error()`
- Logger is imported from `src/utils/logger.ts`
- Logs only appear in development, silent in production

### Security Requirements
- Input validation on all user inputs
- SQL injection prevention via parameterized queries
- XSS prevention via proper escaping
- Supabase RLS policies for database access
- Rate limiting on API endpoints
- Never expose API keys in client code

### Strava API Compliance
- Display "Powered by Strava" attribution
- Implement 48-hour data deletion
- Follow Strava branding guidelines
- User data export and deletion rights

### Performance Considerations
- React.memo for expensive components
- Virtualization for long lists
- Optimized images and assets
- Minimize bundle size
- Efficient database queries

## Debugging

### Common Issues

**Issue**: API server not responding
- **Fix**: Ensure `cd server && node server.js` is running
- **Check**: http://localhost:3001/health

**Issue**: Environment variables not working
- **Fix**: Verify `.env.local` exists and has correct values
- **Check**: Run `node test-env-connections.js`

**Issue**: Database connection errors
- **Fix**: Check Supabase credentials in `.env.local`
- **Check**: Verify Supabase project is running

**Issue**: Build errors on web
- **Fix**: Clear cache with `npx expo start --clear`
- **Fix**: Delete `dist/` and rebuild

**Issue**: TypeScript errors
- **Fix**: Run `npx tsc --noEmit` to see all errors
- **Fix**: Update types in `src/types/`

### Debug Tools
- **Expo DevTools**: Access via browser when dev server runs
- **React DevTools**: Install browser extension
- **Redux DevTools**: Install browser extension
- **Logger**: Check `src/utils/logger.ts` output in console

## Quick Reference

| Task | Command | Notes |
|------|---------|-------|
| Start dev server | `npm start` | Opens Expo DevTools |
| Start API server | `cd server && node server.js` | Port 3001 |
| Start web | `npm run web` | Port 8081 |
| Build web | `npm run build:web` | Output to dist/ |
| Run tests | `npm test` | All tests |
| Lint code | `npm run lint` | ESLint |
| Check types | `npx tsc --noEmit` | TypeScript |
| Test API connections | `node test-env-connections.js` | Verify .env.local |
| Check git remote | `git remote -v` | Verify repo |
| Current directory | `pwd` | Should be RacePrep/ |

## Getting Help

- **Project docs**: See DOCUMENTATION_INDEX.md for complete catalog
- **Issues**: Create issues at https://github.com/tigerswim/raceprep/issues
- **Expo docs**: https://docs.expo.dev
- **React Native docs**: https://reactnative.dev
- **Supabase docs**: https://supabase.com/docs

## Project Philosophy

RacePrep is designed to understand triathlon races as complete events, not three separate sports. This means:

1. **Integrated race analysis** - Swim, bike, run, and transitions analyzed together
2. **Race-specific planning** - Tools tailored for race day preparation
3. **Performance insights** - AI-powered recommendations based on complete race data
4. **User-centric design** - Beautiful, intuitive mobile experience
5. **Privacy-focused** - User data remains private and under user control

## Development Team

- **Built with**: React Native, Expo, TypeScript, Supabase
- **Developed by**: Kinetic Brand Partners
- **AI Assistant**: Claude Code (Anthropic)
- **License**: Private project ¬© 2024

---

**Last Updated**: January 2025
**Workspace**: `/Users/danhoeller/Website Development/kineticbrandpartners/RacePrep/`
**Repository**: `https://github.com/tigerswim/raceprep.git`
**Branch**: `main`

---

Built with ‚ù§Ô∏è for the triathlon community
